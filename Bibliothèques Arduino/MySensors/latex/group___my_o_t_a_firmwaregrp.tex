\hypertarget{group___my_o_t_a_firmwaregrp}{}\doxysection{My\+O\+T\+A\+Firmware\+Update}
\label{group___my_o_t_a_firmwaregrp}\index{MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}}


A\+PI declaration for My\+O\+T\+A\+Firmware\+Update.  


Collaboration diagram for My\+O\+T\+A\+Firmware\+Update\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group___my_o_t_a_firmwaregrp}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{union____attribute____}{\+\_\+\+\_\+attribute\+\_\+\+\_\+}}
\begin{DoxyCompactList}\small\item\em FW config structure, stored in eeprom. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga3758dd5d300a594312c95bc393378df0}\label{group___my_o_t_a_firmwaregrp_ga3758dd5d300a594312c95bc393378df0}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}}~static
\begin{DoxyCompactList}\small\item\em static \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga390e41b462f28fc760f47e4b658c377e}\label{group___my_o_t_a_firmwaregrp_ga390e41b462f28fc760f47e4b658c377e}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga390e41b462f28fc760f47e4b658c377e}{F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+B\+L\+O\+C\+K\+\_\+\+S\+I\+ZE}}~(16u)
\begin{DoxyCompactList}\small\item\em Size of each firmware block. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_gaec637bce5a91d2da1746ddd440a1a608}\label{group___my_o_t_a_firmwaregrp_gaec637bce5a91d2da1746ddd440a1a608}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gaec637bce5a91d2da1746ddd440a1a608}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+R\+E\+T\+RY}}~(5u)
\begin{DoxyCompactList}\small\item\em Number of times to request a fw block before giving up. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_gad846ca2c537188d48e20da6c264053d4}\label{group___my_o_t_a_firmwaregrp_gad846ca2c537188d48e20da6c264053d4}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gad846ca2c537188d48e20da6c264053d4}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+R\+E\+T\+R\+Y\+\_\+\+D\+E\+L\+AY}}~(500u)
\begin{DoxyCompactList}\small\item\em Number of milliseconds before re-\/requesting a FW block. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga5618e049ff56a8cdcc4320e85c40ea7e}\label{group___my_o_t_a_firmwaregrp_ga5618e049ff56a8cdcc4320e85c40ea7e}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga5618e049ff56a8cdcc4320e85c40ea7e}{F\+I\+R\+M\+W\+A\+R\+E\+\_\+\+S\+T\+A\+R\+T\+\_\+\+O\+F\+F\+S\+ET}}~(10u)
\begin{DoxyCompactList}\small\item\em Start offset for firmware in flash (Dual\+Optiboot wants to keeps a signature first) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_gaf008a47e9cd392a1538d683d48078e1a}\label{group___my_o_t_a_firmwaregrp_gaf008a47e9cd392a1538d683d48078e1a}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gaf008a47e9cd392a1538d683d48078e1a}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+M\+A\+J\+O\+R\+\_\+\+V\+E\+R\+S\+I\+ON}}~(3u)
\begin{DoxyCompactList}\small\item\em Bootloader version major. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_gad711bdca0f945b5b116e0aa3dadb9f56}\label{group___my_o_t_a_firmwaregrp_gad711bdca0f945b5b116e0aa3dadb9f56}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gad711bdca0f945b5b116e0aa3dadb9f56}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+M\+I\+N\+O\+R\+\_\+\+V\+E\+R\+S\+I\+ON}}~(0u)
\begin{DoxyCompactList}\small\item\em Bootloader version minor. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga82327e06b932ed3aefc077cf88eb9a54}\label{group___my_o_t_a_firmwaregrp_ga82327e06b932ed3aefc077cf88eb9a54}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga82327e06b932ed3aefc077cf88eb9a54}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+V\+E\+R\+S\+I\+ON}}~(\mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gad711bdca0f945b5b116e0aa3dadb9f56}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+M\+I\+N\+O\+R\+\_\+\+V\+E\+R\+S\+I\+ON}} $\ast$ 256 + \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gaf008a47e9cd392a1538d683d48078e1a}{M\+Y\+\_\+\+O\+T\+A\+\_\+\+B\+O\+O\+T\+L\+O\+A\+D\+E\+R\+\_\+\+M\+A\+J\+O\+R\+\_\+\+V\+E\+R\+S\+I\+ON}})
\begin{DoxyCompactList}\small\item\em Bootloader version. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga7f0424f523f6e84d20591985c055c59c}\label{group___my_o_t_a_firmwaregrp_ga7f0424f523f6e84d20591985c055c59c}} 
\#define \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga7f0424f523f6e84d20591985c055c59c}{O\+T\+A\+\_\+\+D\+E\+B\+UG}}(x, ...)
\begin{DoxyCompactList}\small\item\em debug N\+U\+LL \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} void \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga4d5de5ff78a23f87addb977709656108}{read\+Firmware\+Settings}} (void)
\begin{DoxyCompactList}\small\item\em Read firmware settings from E\+E\+P\+R\+OM. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga7614758cbc443ee5cde6d76274b2f890}\label{group___my_o_t_a_firmwaregrp_ga7614758cbc443ee5cde6d76274b2f890}} 
\mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} void \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga7614758cbc443ee5cde6d76274b2f890}{firmware\+O\+T\+A\+Update\+Request}} (void)
\begin{DoxyCompactList}\small\item\em Handle O\+TA FW update requests. \end{DoxyCompactList}\item 
\mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} bool \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga35a38c4ca63a8e249c1efc1e7f2cf4ad}{firmware\+O\+T\+A\+Update\+Process}} (void)
\begin{DoxyCompactList}\small\item\em Handle O\+TA FW update responses. \end{DoxyCompactList}\item 
\mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} bool \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_gaa1cc2c2cfff66b39fe04c840f7bcba87}{transport\+Is\+Valid\+Firmware}} (void)
\begin{DoxyCompactList}\small\item\em Validate uploaded FW C\+RC. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga42f0364e23a87fba7f52eee29d31cd18}\label{group___my_o_t_a_firmwaregrp_ga42f0364e23a87fba7f52eee29d31cd18}} 
\mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} void \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga42f0364e23a87fba7f52eee29d31cd18}{present\+Bootloader\+Information}} (void)
\begin{DoxyCompactList}\small\item\em Present bootloader/\+FW information upon startup. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A\+PI declaration for My\+O\+T\+A\+Firmware\+Update. 

My\+O\+T\+A\+Firmware\+Update-\/related log messages, format\+: \mbox{[}!\mbox{]}S\+Y\+S\+T\+EM\+:\mbox{[}S\+UB S\+Y\+S\+T\+EM\+:\mbox{]}M\+E\+S\+S\+A\+GE
\begin{DoxyItemize}
\item \mbox{[}!\mbox{]} Exclamation mark is prepended in case of error or warning
\item S\+Y\+S\+T\+EM\+:
\begin{DoxyItemize}
\item {\bfseries{O\+TA}} messages emitted by My\+O\+T\+A\+Firmware\+Update
\end{DoxyItemize}
\item S\+UB S\+Y\+S\+T\+E\+MS\+:
\begin{DoxyItemize}
\item O\+TA\+:{\bfseries{F\+RQ}} from \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga7614758cbc443ee5cde6d76274b2f890}{firmware\+O\+T\+A\+Update\+Request()}}
\item O\+TA\+:{\bfseries{F\+WP}} from \mbox{\hyperlink{group___my_o_t_a_firmwaregrp_ga35a38c4ca63a8e249c1efc1e7f2cf4ad}{firmware\+O\+T\+A\+Update\+Process()}}
\end{DoxyItemize}
\end{DoxyItemize}

My\+O\+T\+A\+Firmware\+Update debug log messages\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{5}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ E }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ S\+YS }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ S\+UB }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Message }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Comment  }\\\cline{1-5}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ E }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ S\+YS }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ S\+UB }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Message }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Comment  }\\\cline{1-5}
\endhead
&O\+TA &F\+WP &U\+P\+D\+A\+TE &FW update initiated  \\\cline{1-5}
! &O\+TA &F\+WP &U\+P\+DO &FW config response received, FW update already ongoing  \\\cline{1-5}
! &O\+TA &F\+WP &F\+L\+A\+SH I\+N\+IT F\+A\+IL &Failed to initialise flash  \\\cline{1-5}
&O\+TA &F\+WP &U\+P\+D\+A\+TE S\+K\+I\+P\+P\+ED &FW update skipped, no newer version available  \\\cline{1-5}
&O\+TA &F\+WP &R\+E\+CV B=\%04X &Received FW block (B)  \\\cline{1-5}
! &O\+TA &F\+WP &W\+R\+O\+NG F\+WB &Wrong FW block received  \\\cline{1-5}
&O\+TA &F\+WP &FW E\+ND &FW received, proceed to C\+RC verification  \\\cline{1-5}
&O\+TA &F\+WP &C\+RC OK &FW C\+RC verification OK  \\\cline{1-5}
! &O\+TA &F\+WP &C\+RC F\+A\+IL &FW C\+RC verification failed  \\\cline{1-5}
&O\+TA &F\+RQ &FW R\+EQ,T=\%04X,V=\%04X,B=\%04X &Request FW update, FW type (T), version (V), block (B)  \\\cline{1-5}
! &O\+TA &F\+RQ &FW U\+PD F\+A\+IL &FW update failed  \\\cline{1-5}
&O\+TA &C\+RC &B=\%04X,C=\%04X,F=\%04X &FW C\+RC verification. FW blocks (B), calculated C\+RC (C), FW C\+RC (F)  \\\cline{1-5}
\end{longtabu}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga35a38c4ca63a8e249c1efc1e7f2cf4ad}\label{group___my_o_t_a_firmwaregrp_ga35a38c4ca63a8e249c1efc1e7f2cf4ad}} 
\index{MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}!firmwareOTAUpdateProcess@{firmwareOTAUpdateProcess}}
\index{firmwareOTAUpdateProcess@{firmwareOTAUpdateProcess}!MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}}
\doxysubsubsection{\texorpdfstring{firmwareOTAUpdateProcess()}{firmwareOTAUpdateProcess()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} bool firmware\+O\+T\+A\+Update\+Process (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Handle O\+TA FW update responses. 

This function handles incoming O\+TA FW packets and stores them to external flash (Sensebender) \mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_ga4d5de5ff78a23f87addb977709656108}\label{group___my_o_t_a_firmwaregrp_ga4d5de5ff78a23f87addb977709656108}} 
\index{MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}!readFirmwareSettings@{readFirmwareSettings}}
\index{readFirmwareSettings@{readFirmwareSettings}!MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}}
\doxysubsubsection{\texorpdfstring{readFirmwareSettings()}{readFirmwareSettings()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} void read\+Firmware\+Settings (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read firmware settings from E\+E\+P\+R\+OM. 

Current firmware settings (type, version, crc, blocks) are read into \+\_\+fc \mbox{\Hypertarget{group___my_o_t_a_firmwaregrp_gaa1cc2c2cfff66b39fe04c840f7bcba87}\label{group___my_o_t_a_firmwaregrp_gaa1cc2c2cfff66b39fe04c840f7bcba87}} 
\index{MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}!transportIsValidFirmware@{transportIsValidFirmware}}
\index{transportIsValidFirmware@{transportIsValidFirmware}!MyOTAFirmwareUpdate@{MyOTAFirmwareUpdate}}
\doxysubsubsection{\texorpdfstring{transportIsValidFirmware()}{transportIsValidFirmware()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group___r_f_m95grp_ga3758dd5d300a594312c95bc393378df0}{L\+O\+C\+AL}} bool transport\+Is\+Valid\+Firmware (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Validate uploaded FW C\+RC. 

This function verifies if uploaded FW C\+RC is valid 