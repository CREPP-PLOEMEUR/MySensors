<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Signing troubleshooting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Signing troubleshooting<div class="ingroups"><a class="el" href="group__publics.html">MySensors public APIs and functionalities</a> &raquo; <a class="el" href="group___my_signinggrp_pub.html">Message signing</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Typical signing related failure cases and how to solve them.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Signing troubleshooting:</div>
<div class="dyncontent">
<div class="center"><img src="group___my_signing_troubleshootinggrp.png" border="0" usemap="#group______my__signing__troubleshootinggrp" alt=""/></div>
<map name="group______my__signing__troubleshootinggrp" id="group______my__signing__troubleshootinggrp">
<area shape="rect" href="group___my_signinggrp_pub.html" title="The message signing infrastructure provides message authenticity to users by signing MySensors messag..." alt="" coords="5,5,136,31"/>
<area shape="rect" title="Typical signing related failure cases and how to solve them." alt="" coords="184,5,360,31"/>
</map>
</div>
<p>Typical signing related failure cases and how to solve them. </p>
<h1><a class="anchor" id="MySigningTroubleshootingSymptoms"></a>
Symptoms and solutions</h1>
<p>The first thing to do if you suspect signing is causing problems, is to enable the verbose debug flag for the signing backend. </p><dl class="section see"><dt>See also</dt><dd>MY_DEBUG_VERBOSE_SIGNING</dd></dl>
<p>If you are having trouble getting signing to work, please see the following troubleshooting tips.</p>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomStFail"></a>
Signing fails and logs show st=fail on transmissions</h2>
<p>This is actually not a signing problem, although often st=fail becomes st=ok when signing is disabled. This is by far the most commonly reported problem with signing, but the problems is not with signing, it is with radio performance.<br  />
 This is a typical log which might look like a signing related issue but isn't: </p><div class="fragment"><div class="line">0;255;3;0;9;Skipping security for command 3 type 16</div>
<div class="line">0;255;3;0;9;read: 3-3-0 s=255,c=3,t=16,pt=0,l=0,sg=0:</div>
<div class="line">0;255;3;0;9;Signing backend: ATSHA204Soft</div>
<div class="line">0;255;3;0;9;SHA256: 86DEAE1DAF50D577A4E2262B33ABF9DEE05DD8FAF84F94F50900000000000000</div>
<div class="line">0;255;3;0;9;Skipping security for command 3 type 17</div>
<div class="line">0;255;3;0;9;send: 0-0-3-3 s=255,c=3,t=17,pt=6,l=25,sg=0,st=fail:86DEAE1DAF50D577A4E2262B33ABF9DEE05DD8FAF84F94F509</div>
<div class="line">0;255;3;0;9;Failed to transmit nonce!</div>
<div class="line">0;255;3;0;9;Message is not signed, but it should have been!</div>
<div class="line">0;255;3;0;9;verify fail</div>
</div><!-- fragment --><p>The reason for this is that when signing is used, the messages transmitted become relatively large.<br  />
 Because of this, the message is more sensitive to noise, and the chance for a message to get scrambled increase with the message size. Please refer to the troubleshooting section at the MySensors forum for information on how to improve radio performance.<br  />
 This is a good place to start: <a href="https://forum.mysensors.org/topic/666/debug-faq-and-how-ask-for-help">https://forum.mysensors.org/topic/666/debug-faq-and-how-ask-for-help</a></p>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomNonce"></a>
Failed to generate nonce</h2>
<p>The signing backend failed to generate the nonce needed to sign a message. This indicate a hardware problem. Please post the debug info on the forum together with a description of your hardware setup.</p>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomSign"></a>
Failed to sign message</h2>
<p>The signing backend failed to sign the message. Typically this happens if your message is so large, that there is no room left in the buffer to store a signature.</p>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomWrongSource"></a>
Nonce did not come from the destination (XX) of the message to be signed! It came from YY</h2>
<p>This should not really happen. The reason for this message is that the signing backend is only capable of handling one signed message session at any time. If for some reason multiple nodes send a nonce message to the same node, only the nonce from a node that is the destination of the current message signing session will be accepted. Any other nonces will be dropped. This should not happen as no node should send a nonce unless asked to, and a node will only ask for a nonce to one destination for every signing session.<br  />
 If you see this message, please post the debugging details on the MySensors forum so it can be investigated further together with a description of your setup.</p>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomNotSigned"></a>
Message is not signed, but it should have been</h2>
<p>A node has failed to comply with the signing preferences of this node. Check that the node has received a signing presentation message from this node. This is automatically transmitted to gateways. For other nodes, you need to transmit the presentation from the sketch. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group___my_signinggrp.html#ga0c8b87323fc0b1b7f657721c8df2f563" title="Does signing specific presentation for a node.">signerPresentation</a></dd></dl>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomNotSignedGeneral"></a>
"Messages do not appear to be signed but I think they should be..."</h2>
<p>Make sure you have enabled the flag to require signatures to require signatures and have enabled one of the signing backends. </p><dl class="section see"><dt>See also</dt><dd>MY_SIGNING_REQUEST_SIGNATURES </dd>
<dd>
MY_SIGNING_ATSHA204 </dd>
<dd>
MY_SIGNING_SOFT</dd></dl>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomNotWorkingWhitelisting"></a>
Signature verification failed!</h2>
<p>Make sure both source and destination of the signed message has undergone <a class="el" href="group___my_signinggrp_pub.html#personalization">personalization</a> with the same HMAC key.<br  />
 Also, if whitelisting is used, make sure the proper serial is paired with the proper node ID at the destination. Whitelisting preferences are communicated with the signing presentation (done automatically from nodes to gateway but has to be explicitly done by sketch for node to node communication). </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group___my_signinggrp.html#ga0c8b87323fc0b1b7f657721c8df2f563" title="Does signing specific presentation for a node.">signerPresentation</a></dd></dl>
<h2><a class="anchor" id="MySigningTroubleshootingSymptomStTampered"></a>
Signing backend reports tampered even after personalization</h2>
<p>The signing backend validates that the secure elements in EEPROM remain unmodified after personalization using a checksum. If the check fails, the backend reports </p><div class="fragment"><div class="line">!SGN:PER:Tampered</div>
</div><!-- fragment --><p> This usually indicate that the sketch has modified the secure elements in EEPROM, but if you experience this even after a node is freshly personalized on a atmega device, it could be that the EESAVE fuse bit is not set which mean that the EEPROM is erased when a new firmware is flashed. You will need to enable the EESAVE bit in order to have the security personalization persist in the node. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
